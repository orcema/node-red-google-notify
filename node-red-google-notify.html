<style>
  .group{
    border:1px solid blue;
    border-radius: 5px;
    box-shadow: 5px 5px 5px;
    padding: 10px;
    margin-top:30px;
  }
  .groupLabel{
    transform: translateY(-20px);
    background-color: white;
    text-align: center;
    width: 150px;
  }
  .overridableInstruction{
    padding-left:15px;
    font-size: smaller;
  }
</style>

<script type="text/javascript">
  RED.nodes.registerType('google-notify-config', {
    category: 'config',
    defaults: {
      ipaddress: {
        value: "",
        required: true
      },
      name: {
        value: ""
      },
      language: {
        value: "en"
      },
      playVolumeLevel: {
        value: "20",
        validate: RED.validators.regex(/^([0-9]|[1-9][0-9]|100)$/)
      },
      speakSlow: {
        value: "true"
      },
      mediaServerUrl: {
        value: ""
      },
      mediaServerPort: {
        value: "8098",
        validate: RED.validators.regex(/^\d+$/)
      },
      cacheFolder: {
        value: "/tmp",
        validate: RED.validators.regex(/^.+$/)
      }
    },
    label: function () {
      return this.name || this.ipaddress;
    },
    oneditprepare: function () {
      var node = this;
      var options = $("#node-config-input-language");
      //Calling the API built by NodeJS code
      $.getJSON('/languages', function (languages) {
        $.each(languages, function (l, language) {
          options.append($("<option />").val(language.key).text(language.value));
          options.val(node.language);
        });
      });

      try {
        $("#node-config-input-ipaddress").autocomplete("destroy");
      } catch (err) { }
      $("#node-config-lookup-ipaddress").click(function () {
        $("#node-config-lookup-ipaddress-icon").removeClass('fa-search');
        $("#node-config-lookup-ipaddress-icon").addClass('spinner');
        $("#node-config-lookup-ipaddress").addClass('disabled');
        $.getJSON('gn-ipaddresses', function (data) {
          $("#node-config-lookup-ipaddress-icon").addClass('fa-search');
          $("#node-config-lookup-ipaddress-icon").removeClass('spinner');
          $("#node-config-lookup-ipaddress").removeClass('disabled');
          var ipaddresses = [];
          $.each(data, function (i, ip) {
            ipaddresses.push(ip);
          });
          $("#node-config-input-ipaddress").autocomplete({
            source: ipaddresses,
            minLength: 0,
            close: function (event, ui) {
              $("#node-config-input-ipaddress").autocomplete("destroy");
              const selectedDevice = ipaddresses.find(device=>device.value==$("#node-config-input-ipaddress").val());
              if(selectedDevice){
                $("#node-config-input-name").val(selectedDevice.device);
              }
              
            }
          }).autocomplete("search", "");
        });
      });

    },
    oneditsave: function () {
      this.language = $("#node-config-input-language").val();
    }
  });
</script>

<script type="text/x-red" data-template-name="google-notify-config">
  <div class="form-row">
    <label for="node-config-input-ipaddress"><i class="icon-bookmark"></i> IP Adress</label>
    <input type="text" id="node-config-input-ipaddress" style="width:60%;" placeholder="192.168.xxx.xxx"/>
    <a id="node-config-lookup-ipaddress" class="btn"><i id="node-config-lookup-ipaddress-icon" class="fa fa-search"></i></a>
  </div>
  <div class="form-row">
    <label for="node-config-input-name"><i class="icon-tag"></i> Name</label>
    <input type="text" id="node-config-input-name" style="width:60%;" placeholder="cast device name"/>
  </div>
  <div class="form-row">
    <label for="node-config-input-language"><i class="fa fa-globe"></i>  Language</label>
    <select id="node-config-input-language" style="width:60%;">
          <!-- <option value="en"> English</option> -->
      </select>
  </div>
  <div class="form-row">
    <label for="node-config-input-playVolumeLevel" style="white-space: nowrap;width:160px;"><i class="fa fa-volume-up" ></i> Play volume level (%)</label>
    <input type="text" id="node-config-input-playVolumeLevel" style="width:50px;" placeholder="20"/>
  </div>
  <div class="form-row">
    <label for="node-config-input-speakSlow" style="white-space: nowrap;width:100px;"><i class="fa fa-volume-up" ></i> Speak slow</label>
    <input type="checkbox" id="node-config-input-speakSlow" style="width:50px;" />
  </div>
  <div class="form-row">
    <label style="width:40%;"><i class="fa fa-server" ></i> Media server</label>
    <li>
      <label for="node-config-input-mediaServerUrl" >url</label>
      <input type="text" id="node-config-input-mediaServerUrl" placeholder="http://[ip/domain]"/>
    </li>
    <li>
      <label for="node-config-input-mediaServerPort" >listening port</label>
      <input type="text" id="node-config-input-mediaServerPort" style="width:75px;" placeholder="8098"/>
    </li>
    <li>
      <label for="node-config-input-cacheFolder" > cache folder</label>
      <input type="text" id="node-config-input-cacheFolder" placeholder="/tmp"/>
    </li>
  </div>

</script>


<!-- ###############################################################################################################-->

<script type="text/javascript">
  RED.nodes.registerType('google-notify', {
    category: 'media',
    color: '#6699ff',
    defaults: {
      server: {
        value: "",
        type: "google-notify-config"
      },
      name: {
        value: ""
      },
      playVolumeLevel: {
        value: "",
        validate: RED.validators.regex(/^(\s*|[0-9]|[1-9][0-9]|100)$/)
      },
      playMessage:{
        value:""
      },
      language: {
        value: "config"
      },
      speakSlow: {
        value: "config"
      },
      mediaUrl: {
        value: ""
      },
      mediaType: {
        value: "mp3"
      },

    },
    inputs: 1,
    outputs: 1,
    icon: "font-awesome/fa-comments",
    label: function () {
      return this.configname || this.name || "Google notify";
    },
    oneditprepare: function () {
      var node = this;
      var options = $("#node-input-language");
      //Calling the API built by NodeJS code
      options.append($("<option />").val('config').text('use config'));
      console.log('debugger')
      $.getJSON('/languages', function (languages) {
        $.each(languages, function (l, language) {
          options.append($("<option />").val(language.key).text(language.value));
          options.val(node.language);
        });
      });

      var optionsMediaTypes = $("#node-input-mediaType");
      //Calling the API built by NodeJS code
      $.getJSON('/gn-contentTypes', function (mediaTypes) {
        console.log('debugger')
        $.each(mediaTypes, function (value, mediaType) {
          optionsMediaTypes.append($("<option />").val(value).text(mediaType));
          optionsMediaTypes.val(node.mediaType);
        });
      });
    },
    oneditsave: function () {
      this.language = $("#node-input-language").val();
    }
  });
</script>

<script type="text/x-red" data-template-name="google-notify">
  <div class="form-row">
    <label for="node-input-server">Cast Device</label>
    <input type="text" id="node-input-server">
  </div>

  <div class="form-row">
    <label for="node-input-name"><i class="icon-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Google notify" style="width: 70%;">
  </div>

  <div class="form-row">
    <label for="node-input-playVolumeLevel" style="white-space: nowrap;width:160px;"><i class="fa fa-volume-up" ></i> Play volume level (%)</label>
    <input type="text" id="node-input-playVolumeLevel" style="width:80px;text-align:center;" placeholder="use config"/>
    <p class="overridableInstruction"><i class="fa fa-arrow-circle-right"></i> <i>overridable with <b>msg.playVolumeLevel</b> [0-100]</i></p>
  </div>

  <div class="group">
    <div class="groupLabel">Play voice Message</div>
    <div class="form-row">
      <label for="node-input-playMessage"><i class="fa fa-comment" ></i></i> Text</label>
      <input type="text" id="node-input-playMessage" placeholder="voice message" style="width: 70%;">
      <p class="overridableInstruction"><i class="fa fa-arrow-circle-right"></i> <i>overridable with <b>msg.playMessage</b> </i></p>
    </div>

    <div class="form-row">
      <label for="node-input-language"><i class="fa fa-globe"></i>  Language</label>
      <select id="node-input-language" style="width:60%;">
      </select>
      <p class="overridableInstruction"><i class="fa fa-arrow-circle-right"></i> <i>overridable with <b>msg.language</b> [en|fr|de|...]</i></p>
    </div>

    <div class="form-row">
      <label for="node-input-speakSlow" style="white-space: nowrap;"><i class="fa fa-volume-up" ></i> Speak slow</label>
      <select id="node-input-speakSlow" style="width:100px;">
        <option value="config">use config</option>
        <option value="true"> YES</option>
        <option value="false"> NO</option>
      </select>
      <p class="overridableInstruction"><i class="fa fa-arrow-circle-right"></i> <i>overridable with <b>msg.speakSlow</b> [true|false]</i></p>
    </div>
  </div>
  <div class="group">
    <div class="groupLabel">Play media</div>
    <div class="form-row">
      <label for="node-input-mediaUrl"><i class="icon-tag"></i>Media to play</label>
      <input type="text" id="node-input-mediaUrl" placeholder="url to media to play" style="width: 70%;">
      <p class="overridableInstruction"><i class="fa fa-arrow-circle-right"></i> <i>overridable with <b>msg.mediaUrl</b> </i></p>

    </div>

    <!-- <div class="form-row">
      <label for="node-input-mediaType" style="white-space: nowrap;"><i class="fa fa-film" ></i> Media Type</label>
      <select id="node-input-mediaType" style="width:70%;">
      </select>
      <p class="overridableInstruction"><i class="fa fa-arrow-circle-right"></i> <i>overridable with <b>msg.mediaType</b> </i></p>
    </div> -->

  </div>


</script>